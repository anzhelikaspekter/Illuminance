<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Verify your identity using the authentication code from your authenticator app to securely access your account.">
    <title>Authenticator Verification</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.min.css">
</head>


<body class="section auth-verification">
    <!-- Header -->
    <header class="auth-verification__header" role="banner">
        <button id="close-btn" class="icon close large" type="button" aria-label="Close"></button>
    </header>
    <!-- Main -->
    <main id="main" class="auth-verification__wrap" tabindex="-1">
        <div class="auth-verification__form">
            <div class="auth-verification__title-wrap">
                <h1 class="title primary primary--light">Enter the 6-digit code from your authenticator app</h1>
                <p class="desc primary primary--middle">This helps us keep your account secure by verifying that it’s
                    really
                    you.</p>
            </div>

            <!-- novalidate; data-expected-code — только для демо -->
            <form action="#" method="post" class="form" autocomplete="one-time-code" novalidate
                data-expected-code="123456">
                <div class="form__input-field">
                    <div class="form__code-field" aria-describedby="otp-hint otp-error otp-status" role="group"
                        aria-label="6-digit authentication code">
                        <input id="otp" class="real-input" type="text" name="otp" inputmode="numeric" pattern="\d{6}"
                            minlength="6" maxlength="6" autocomplete="one-time-code" aria-invalid="false"
                            aria-describedby="otp-hint otp-error otp-status">
                        <span class="form__code" aria-hidden="true"></span>
                        <span class="form__code" aria-hidden="true"></span>
                        <span class="form__code" aria-hidden="true"></span>
                        <span class="form__code" aria-hidden="true"></span>
                        <span class="form__code" aria-hidden="true"></span>
                        <span class="form__code" aria-hidden="true"></span>
                    </div>

                    <p id="otp-hint" class="visually-hidden desc primary primary--light">Enter the six digits from your
                        authenticator app</p>
                    <p id="otp-error" class="desc primary primary--error hide" role="alert">The code you entered is not
                        valid</p>
                    <p id="otp-status" class="visually-hidden" role="status" aria-live="polite"></p>
                </div>

                <div class="form__btns-field">
                    <button type="submit" class="form__btn disabled" disabled>Verify code</button>

                    <div class="form__reg-field">
                        <span class="desc primary primary--middle">Don't have an account?</span>
                        <a href="sign-up.html" class="form__link">Sign Up</a>
                    </div>
                </div>
            </form>
        </div>

        <p class="desc primary primary--middle">By registering, you agree to the Privacy and Data Use Policy.</p>
    </main>
    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            /* ОTP-ФОРМА */
            const form = document.querySelector('.form');
            const expectedCode = (form?.dataset.expectedCode || '').replace(/\D/g, ''); // демо: "123456"

            const codeField = form.querySelector('.form__code-field');
            const input = form.querySelector('#otp.real-input');
            const boxes = Array.from(codeField.querySelectorAll('.form__code'));
            const hint = document.getElementById('otp-hint');
            const err = document.getElementById('otp-error');

            const submitBtn = form.querySelector('.form__btn');
            const resendField = form.querySelector('.form__resend-field');
            const resendBtn = resendField.querySelector('.form__link.resend');
            const resendTimer = resendField.querySelector('span[aria-hidden="true"]');

            function onlyDigits(v) { return (v || '').replace(/\D/g, ''); }

            function setError(msg) {
                if (msg) err.textContent = msg;
                err.classList.remove('hide');
                input.setAttribute('aria-invalid', 'true');
                boxes.forEach(b => b.classList.add('error'));
            }
            function clearError() {
                err.classList.add('hide');
                input.setAttribute('aria-invalid', 'false');
                boxes.forEach(b => b.classList.remove('error'));
            }
            function setSubmitEnabled(on) {
                submitBtn.disabled = !on;
                submitBtn.classList.toggle('disabled', !on);
            }

            function render() {
                const val = onlyDigits(input.value).slice(0, boxes.length);
                input.value = val;

                boxes.forEach((b, i) => {
                    b.textContent = val[i] || '';
                    b.classList.toggle('filled', Boolean(val[i]));
                });

                if (val.length < boxes.length) {
                    clearError();
                    setSubmitEnabled(false);
                    return;
                }
                if (expectedCode && val !== expectedCode) {
                    setError('The code you entered is not valid');
                    setSubmitEnabled(false);
                } else {
                    clearError();
                    setSubmitEnabled(true);
                }
            }

            codeField.addEventListener('click', () => input.focus());
            input.addEventListener('input', render);

            form.addEventListener('submit', (e) => {
                const val = onlyDigits(input.value);
                if (val.length !== boxes.length) {
                    e.preventDefault();
                    setError('Please enter the 6-digit code.');
                    setSubmitEnabled(false);
                    input.focus();
                    return;
                }
                if (expectedCode && val !== expectedCode) {
                    e.preventDefault();
                    setError('The code you entered is not valid');
                    setSubmitEnabled(false);
                    input.select();
                    return;
                }
            });

            /* RESEND */
            let cooldown = 0, timerId = null;

            function updateTimer() {
                if (cooldown > 0) {
                    resendBtn.disabled = true;
                    resendBtn.classList.add('disabled');
                    resendTimer.textContent = `in ${cooldown}s`;
                    resendTimer.classList.remove('hide');
                } else {
                    resendBtn.disabled = false;
                    resendBtn.classList.remove('disabled');
                    resendTimer.classList.add('hide');
                }
            }
            function startCooldown(sec) {
                cooldown = sec;
                updateTimer();
                if (timerId) clearInterval(timerId);
                timerId = setInterval(() => {
                    cooldown -= 1;
                    updateTimer();
                    if (cooldown <= 0) { clearInterval(timerId); timerId = null; }
                }, 1000);
            }

            resendBtn.addEventListener('click', () => {
                startCooldown(30);
            });

            /* INIT */
            document.getElementById('main')?.focus();
            input.focus();
            render();
            updateTimer();
        });
    </script>
</body>


</html>